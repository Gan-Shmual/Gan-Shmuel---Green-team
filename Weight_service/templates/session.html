{% extends "layout.html" %} {% block title %}Find Session - Weight Service{%
endblock %} {% block content %}
<div class="max-w-2xl mx-auto">
  <!-- Search Card -->
  <div class="bg-white rounded-xl shadow-md p-6 mb-6">
    <h2 class="text-xl font-bold text-gray-800 mb-4">Find Weighing Session</h2>
    <div class="flex gap-4">
      <div class="relative flex-grow">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <i class="fas fa-search text-gray-400"></i>
        </div>
        <input
          type="text"
          id="sessionId"
          class="pl-10 w-full rounded-lg border-gray-300 border p-2.5 focus:ring-primary focus:border-primary"
          placeholder="Enter Session ID (e.g. 1001)"
        />
      </div>
      <button
        onclick="lookupSession()"
        class="bg-primary hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors"
      >
        Search
      </button>
    </div>
  </div>

  <!-- Results Card (Hidden by default) -->
  <div
    id="sessionResult"
    class="hidden bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200"
  >
    <div
      class="bg-gray-50 px-6 py-4 border-b border-gray-200 flex justify-between items-center"
    >
      <h3 class="font-bold text-gray-700">Session Details</h3>
      <span
        id="resId"
        class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded"
        >ID: --</span
      >
    </div>

    <div class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Truck Info -->
        <div class="bg-slate-50 p-4 rounded-lg">
          <p class="text-sm text-gray-500 mb-1">Truck License</p>
          <p id="resTruck" class="text-lg font-bold text-gray-800">--</p>
        </div>

        <!-- Direction/Status -->
        <div class="bg-slate-50 p-4 rounded-lg">
          <p class="text-sm text-gray-500 mb-1">Status</p>
          <span
            id="resStatus"
            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800"
          >
            Unknown
          </span>
        </div>

        <!-- Weight Data -->
        <div class="col-span-1 md:col-span-2">
          <h4
            class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3"
          >
            Weight Measurements
          </h4>
          <div class="grid grid-cols-3 gap-4">
            <div class="text-center p-3 border rounded-lg">
              <p class="text-xs text-gray-500">Bruto</p>
              <p
                id="resBruto"
                class="font-mono text-lg font-bold text-gray-900"
              >
                --
              </p>
            </div>
            <div class="text-center p-3 border rounded-lg">
              <p class="text-xs text-gray-500">Tara</p>
              <p id="resTara" class="font-mono text-lg font-bold text-gray-900">
                --
              </p>
            </div>
            <div
              class="text-center p-3 border rounded-lg bg-green-50 border-green-100"
            >
              <p class="text-xs text-green-600 font-bold">Neto</p>
              <p
                id="resNeto"
                class="font-mono text-lg font-bold text-green-700"
              >
                --
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  async function lookupSession() {
    const id = document.getElementById("sessionId").value.trim();
    if (!id) {
      showNotification("Warning", "Please enter a Session ID", "warning");
      return;
    }

    try {
      // Fetch from API
      const res = await fetch(`/api/session/${id}`);

      if (!res.ok) {
        throw new Error("Session not found");
      }

      const data = await res.json();

      // Populate UI
      document.getElementById("resId").textContent = `ID: ${data.id}`;
      document.getElementById("resTruck").textContent = data.truck || "N/A";
      document.getElementById("resBruto").textContent = data.bruto;

      // Handle Logic for IN vs OUT based on data presence
      const isOut = data.neto && data.neto !== "na";

      document.getElementById("resTara").textContent = data.truckTara || "-";
      document.getElementById("resNeto").textContent = data.neto || "-";

      const statusEl = document.getElementById("resStatus");
      if (isOut) {
        statusEl.className =
          "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800";
        statusEl.textContent = "COMPLETED (OUT)";
      } else {
        statusEl.className =
          "inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800";
        statusEl.textContent = "PENDING (IN)";
      }

      // Show result
      document.getElementById("sessionResult").classList.remove("hidden");
    } catch (err) {
      document.getElementById("sessionResult").classList.add("hidden");
      showNotification("Error", err.message, "error");
    }
  }
</script>
{% endblock %}
