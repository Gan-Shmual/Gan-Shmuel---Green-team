{% extends "layout.html" %} {% block title %}Session Details - Weight Service{%
endblock %} {% block content %}
<div class="bg-white p-6 rounded-lg shadow">
  <h2 class="text-xl font-semibold mb-4">Session Details</h2>

  <div class="mb-4">
    <label class="block text-sm font-medium text-gray-700">Session ID</label>
    <div class="mt-1 flex rounded-md shadow-sm">
      <input
        type="text"
        id="session-id"
        placeholder="Enter session ID"
        class="flex-1 focus:ring-primary focus:border-primary block w-full min-w-0 rounded-none rounded-l-md sm:text-sm border-gray-300"
      />
      <button
        id="get-session"
        class="-ml-px relative inline-flex items-center space-x-2 px-4 py-2 border border-gray-300 text-sm font-medium rounded-r-md text-gray-700 bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-primary focus:border-primary"
      >
        Get Details
      </button>
    </div>
  </div>

  <div id="session-details" class="hidden">
    <div class="bg-gray-50 p-4 rounded-md">
      <h3 class="text-lg font-medium mb-3">Session Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <p class="text-sm font-medium text-gray-500">ID</p>
          <p id="detail-id" class="text-sm text-gray-900"></p>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-500">Truck</p>
          <p id="detail-truck" class="text-sm text-gray-900"></p>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-500">Bruto</p>
          <p id="detail-bruto" class="text-sm text-gray-900"></p>
        </div>
        <div id="out-details" class="hidden">
          <p class="text-sm font-medium text-gray-500">Truck Tara</p>
          <p id="detail-truck-tara" class="text-sm text-gray-900"></p>
        </div>
        <div id="out-details-2" class="hidden">
          <p class="text-sm font-medium text-gray-500">Neto</p>
          <p id="detail-neto" class="text-sm text-gray-900"></p>
        </div>
      </div>
    </div>
  </div>

  <div id="session-error" class="hidden mt-4">
    <div class="bg-red-50 border-l-4 border-red-400 p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <i class="fas fa-exclamation-circle text-red-400"></i>
        </div>
        <div class="ml-3">
          <p class="text-sm text-red-700" id="error-message"></p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const getSessionButton = document.getElementById("get-session");
    const sessionIdInput = document.getElementById("session-id");
    const sessionDetails = document.getElementById("session-details");
    const sessionError = document.getElementById("session-error");
    const errorMessage = document.getElementById("error-message");
    const outDetails = document.getElementById("out-details");
    const outDetails2 = document.getElementById("out-details-2");

    // Check if session ID is in URL
    const urlParams = new URLSearchParams(window.location.search);
    const sessionIdFromUrl = urlParams.get("id");
    if (sessionIdFromUrl) {
      sessionIdInput.value = sessionIdFromUrl;
      getSessionButton.click();
    }

    getSessionButton.addEventListener("click", function () {
      const sessionId = sessionIdInput.value.trim();
      if (!sessionId) {
        showNotification("Error", "Please enter a session ID", "error");
        return;
      }

      sessionDetails.classList.add("hidden");
      sessionError.classList.add("hidden");
      outDetails.classList.add("hidden");
      outDetails2.classList.add("hidden");

      fetch(`/session/${sessionId}`)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Session not found");
          }
          return response.json();
        })
        .then((session) => {
          document.getElementById("detail-id").textContent = session.id;
          document.getElementById("detail-truck").textContent =
            session.truck || "na";
          document.getElementById("detail-bruto").textContent = session.bruto;

          // Check if this is an "out" session
          if (session.hasOwnProperty("truckTara")) {
            document.getElementById("detail-truck-tara").textContent =
              session.truckTara;
            outDetails.classList.remove("hidden");
          }

          if (session.hasOwnProperty("neto")) {
            document.getElementById("detail-neto").textContent =
              session.neto || "na";
            outDetails2.classList.remove("hidden");
          }

          sessionDetails.classList.remove("hidden");
        })
        .catch((error) => {
          errorMessage.textContent = error.message;
          sessionError.classList.remove("hidden");
          showNotification("Error", error.message, "error");
          console.error("Error:", error);
        });
    });
  });
</script>
{% endblock %}
